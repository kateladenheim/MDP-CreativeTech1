<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ecology</title>
</head>
<body>
    <script src="https://cdn.jsdelivr.net/npm/p5@1.0.0/lib/p5.js"></script>
    <script>
        
        let urlKate = "https://api.particle.io/v1/devices/3b0034000147393033373334/therm_value?access_token=0725e4850e09dcd77263fb4eb3b2f83847384c81";

        let urlChristie = "https://api.particle.io/v1/devices/2b0023001847393035313138/light_value?access_token=9bd94f45243608f78087ed47c3be88bb1a7ecade";

        let urlIsa = "https://api.particle.io/v1/devices/22003e000c47373336323230/flex_value?access_token=0725e4850e09dcd77263fb4eb3b2f83847384c81";

        let dataKate = "";
        let dataChristie = "";
        let dataIsa = "";
        let currentTime, prevTime;
        let valueKate = 1;
        let valueKate_smoothed = 1;
        let valueChristie = 1;
        let valueIsa = 1;

        var w = window.innerWidth;
        var h = window.innerHeight;

        let pg;
        //let christie_text;

        let a = 0.0;
        let s = 0.0;
        
        function preload () {
            bebasNeue = loadFont ('fonts/BebasNeue-Regular.otf');
        }

        function setup() {
            createCanvas(w, h);
            textAlign(CENTER);
          
            pg = createGraphics(w,h);
            //christie_text = createGraphics(w,h);
        }

        function draw() { 
          
          background(61,62,64);

            currentTime = millis () % 1000;
            if(currentTime < prevTime) {
                dataKate = loadJSON(urlKate, processDataKate, handleError);
                dataChristie = loadJSON(urlChristie, processDataChristie, handleError);
              dataIsa = loadJSON(urlIsa, processDataIsa, handleError);
            }
            
            pg.background("rgba(61,62,64,0.0)")
            valueKate_smoothed = lerp (valueKate_smoothed, valueKate, 0.05);
            scale(1,valueKate_smoothed);
            textAlign(CENTER, CENTER);
            drawWords(width * 0.5);
          
            image(pg, 0, 0, w, h);
          
            if (dataIsa.result = "above") {
              dontTouch();
            }
                    
            if (dataChristie.result > 1000) {
                brightLights();
            }
            
            prevTime = currentTime;
                
        }

        function dontTouch () {
            a = a + 0.05;
            s = cos(a) * 2;
                
            translate(width / 2, height / 2);
            scale(s);
            fill(51);
            text("me", 0, 0);
            textSize(20);
                
            translate(75, 0);
            fill(255);
            scale(s);
            text("don't touch", 0, 0);
            textSize(20);
        }

        function brightLights () {
            fill(128 + sin(frameCount*0.2) * 128);
            textSize (40);
            text("BRIGHT", w / 3, h / 3);
                
            fill(128 + sin(frameCount*0.2) * 128);
            textSize (40);
            text("LIGHTS!", (w / 3) * 2, (h / 3) * 2);
        }

        function drawWords(x) {
            fill(209,210,211);
            textSize(170);
            textFont(bebasNeue);
            text('STREEEEEEETCH', x, 85);
        }

        function processDataKate(dataKate) {
            console.log(dataKate.result);
            valueKate = map(parseInt(dataKate.result), 850, 1300, 2, 20);
            console.log("kate value: " + valueKate);
        }

        function processDataChristie(dataChristie) {
            //console.log(dataChristie.result);
            //valueChristie = map(parseInt(dataChristie.result), 0, 4096, 0, width);
            console.log("christie value: " + dataChristie.result);
        }

        function processDataIsa(dataIsa) {
            //console.log(dataIsa.result);
            //valueIsa = map(parseInt(dataIsa.result), 0, 4096, 0, width);
            console.log("isabelle value: " + dataIsa.result);
        }

        function handleError(error) {
            console.log(error);

        }

    </script>
</body>
</html>